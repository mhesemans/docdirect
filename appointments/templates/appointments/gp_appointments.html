<!-- 
Displays upcoming appointments assigned to the logged-in GP.
Allows them to view, add notes, and mark appointments as complete.

**Context**
- appointments: Queryset of upcoming :model:`appointments.Appointment` assigned to the GP

**Template**
- appointments/gp_appointments.html 
-->

{% extends "base.html" %}
{% block content %}
<div class="container py-5">
  <h2 class="mb-4">My Scheduled Appointments</h2>

  {% if appointments %}
    <div class="list-group">
      {% for appointment in appointments %}
        <form method="post" action="{% url 'appointments:mark_completed' appointment.id %}" class="list-group-item mb-4">
          {% csrf_token %}
          <h5>
            {{ appointment.date|date:"F j, Y" }} at {{ appointment.time|time:"H:i" }}
          </h5>
          <p>
            Patient: {{ appointment.patient.get_full_name }}<br>
            Reason: {{ appointment.reason_for_visit }}<br>
            Preferred Contact: {{ appointment.get_preferred_contact_display }}
          </p>
          <div class="mb-3">
            <label for="notes-{{ appointment.id }}" class="form-label">Notes</label>
            <textarea 
              id="notes-{{ appointment.id }}" 
              name="notes" 
              class="form-control"
              rows="3"
            >{{ appointment.notes }}</textarea>
          </div>
          <div class="form-check mb-3">
            <input 
              class="form-check-input" 
              type="checkbox" 
              name="is_completed" 
              id="completed-{{ appointment.id }}"
              {% if appointment.is_completed %}checked{% endif %}
            >
            <label class="form-check-label" for="completed-{{ appointment.id }}">
              Mark as completed
            </label>
          </div>
          <button type="submit" class="btn btn-primary btn-sm">Save</button>
        </form>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-info">
      You have no upcoming appointments.
    </div>
  {% endif %}
</div>
{% endblock %}
